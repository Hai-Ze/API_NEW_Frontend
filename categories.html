<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Danh m·ª•c</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: Arial, sans-serif; color: #495057; }
        .container { max-width: 1000px; margin-top: 20px; }
        .card { border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; background-color: white; border-radius: 10px; }
        .card-header { background: linear-gradient(135deg, #6c757d, #495057); color: white; font-weight: bold; border-radius: 10px 10px 0 0; }
        .navbar { background: linear-gradient(135deg, #495057, #6c757d); }
        .navbar-brand, .nav-link { color: white !important; }
        .nav-link:hover { color: #adb5bd !important; }
        .btn-group .btn { margin: 0 2px; }
        .stats-row { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #e9ecef; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: #495057; }
        .stat-label { color: #6c757d; font-size: 1rem; margin-top: 5px; }
        .table { background-color: white; color: #495057; }
        .table-dark { background-color: #495057; color: white; }
        .form-control { background-color: #f8f9fa; border: 2px solid #e9ecef; color: #495057; border-radius: 8px; }
        .form-control:focus { background-color: white; border-color: #6c757d; color: #495057; box-shadow: 0 0 0 0.2rem rgba(108, 117, 125, 0.25); }
        .form-control::placeholder { color: #adb5bd; }
        .btn-success { background-color: #28a745; border-color: #28a745; border-radius: 8px; }
        .btn-warning { background-color: #ffc107; border-color: #ffc107; color: #212529; border-radius: 8px; }
        .btn-danger { background-color: #dc3545; border-color: #dc3545; border-radius: 8px; }
        .btn-outline-secondary { color: #6c757d; border-color: #6c757d; border-radius: 8px; }
        .btn-outline-secondary:hover { background-color: #6c757d; border-color: #6c757d; color: white; }
        .text-muted { color: #6c757d !important; }
        .text-primary { color: #007bff !important; }
        .badge.bg-info { background-color: #17a2b8 !important; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="index.html">üè™ C·ª≠a h√†ng</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link active" href="categories.html">üì¶ Danh m·ª•c</a>
                <a class="nav-link" href="products.html">üõçÔ∏è S·∫£n ph·∫©m</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1>üì¶ QU·∫¢N L√ù DANH M·ª§C</h1>
            <p class="text-muted">Th√™m, s·ª≠a, x√≥a danh m·ª•c s·∫£n ph·∫©m</p>
        </div>

        <!-- Statistics -->
        <div class="stats-row">
            <div class="row">
                <div class="col-md-6 stat-item">
                    <div class="stat-number" id="totalCategories">0</div>
                    <div class="stat-label">T·ªïng danh m·ª•c</div>
                </div>
                <div class="col-md-6 stat-item">
                    <button class="btn btn-outline-secondary btn-sm" onclick="refreshData()">üîÑ L√†m m·ªõi</button>
                </div>
            </div>
        </div>

        <!-- Add/Edit Form -->
        <div class="card">
            <div class="card-header">
                <h5 id="formTitle">‚ûï Th√™m danh m·ª•c m·ªõi</h5>
            </div>
            <div class="card-body">
                <form id="categoryForm">
                    <input type="hidden" id="editingId">
                    <div class="row">
                        <div class="col-md-4">
                            <input type="text" class="form-control" id="categoryName" placeholder="T√™n danh m·ª•c *" required>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="categoryDescription" placeholder="M√¥ t·∫£ danh m·ª•c">
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-success w-100" id="btnSave" onclick="saveCategory()">
                                ‚ûï Th√™m
                            </button>
                        </div>
                    </div>
                    <div class="mt-2">
                        <button type="button" class="btn btn-secondary btn-sm" id="btnCancel" onclick="cancelEdit()" style="display: none;">
                            ‚ùå H·ªßy
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Search -->
        <div class="card">
            <div class="card-body">
                <input type="text" class="form-control" id="searchInput" placeholder="üîç T√¨m ki·∫øm danh m·ª•c..." onkeyup="searchCategories()">
            </div>
        </div>

        <!-- Categories Table -->
        <div class="card">
            <div class="card-header">
                <h5>üìã Danh s√°ch danh m·ª•c</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th style="width: 60px;">ID</th>
                                <th>T√™n danh m·ª•c</th>
                                <th>M√¥ t·∫£</th>
                                <th style="width: 100px;">S·∫£n ph·∫©m</th>
                                <th style="width: 150px;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesList">
                            <tr>
                                <td colspan="5" class="text-center">üîÑ ƒêang t·∫£i d·ªØ li·ªáu...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://localhost:7077/api';
        let categories = [];
        let products = [];
        let editingId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', loadData);

        // Load all data
        async function loadData() {
            try {
                const [categoriesRes, productsRes] = await Promise.all([
                    fetch(`${API_URL}/CategoryApi`),
                    fetch(`${API_URL}/ProductApi`)
                ]);
                
                categories = await categoriesRes.json();
                products = await productsRes.json();
                
                updateDisplay();
                updateStats();
            } catch (error) {
                showError('L·ªói khi t·∫£i d·ªØ li·ªáu: ' + error.message);
            }
        }

        // Update display
        function updateDisplay() {
            const tbody = document.getElementById('categoriesList');
            
            if (categories.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">Ch∆∞a c√≥ danh m·ª•c n√†o</td></tr>';
                return;
            }

            tbody.innerHTML = categories.map(cat => {
                const productCount = products.filter(p => p.categoryId === cat.id).length;
                return `
                    <tr>
                        <td><strong>#${cat.id}</strong></td>
                        <td><strong class="text-primary">${cat.name}</strong></td>
                        <td>${cat.description || '<em class="text-muted">Kh√¥ng c√≥</em>'}</td>
                        <td class="text-center">
                            <span class="badge bg-info">${productCount}</span>
                        </td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editCategory(${cat.id})" title="S·ª≠a">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteCategory(${cat.id})" title="X√≥a">
                                üóëÔ∏è
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Update statistics
        function updateStats() {
            const totalCats = categories.length;
            document.getElementById('totalCategories').textContent = totalCats;
        }

        // Save category
        async function saveCategory() {
            const name = document.getElementById('categoryName').value.trim();
            const description = document.getElementById('categoryDescription').value.trim();
            
            if (!name) {
                alert('Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!');
                return;
            }

            try {
                const data = { name, description };
                let response;

                if (editingId) {
                    data.id = editingId;
                    response = await fetch(`${API_URL}/CategoryApi/${editingId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    alert('C·∫≠p nh·∫≠t th√†nh c√¥ng!');
                } else {
                    response = await fetch(`${API_URL}/CategoryApi`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    alert('Th√™m danh m·ª•c th√†nh c√¥ng!');
                }

                if (!response.ok) throw new Error('L·ªói API');
                
                resetForm();
                loadData();
            } catch (error) {
                alert('L·ªói: ' + error.message);
            }
        }

        // Edit category
        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;

            editingId = id;
            document.getElementById('categoryName').value = category.name;
            document.getElementById('categoryDescription').value = category.description || '';
            document.getElementById('formTitle').textContent = '‚úèÔ∏è Ch·ªânh s·ª≠a danh m·ª•c';
            document.getElementById('btnSave').innerHTML = 'üíæ C·∫≠p nh·∫≠t';
            document.getElementById('btnSave').className = 'btn btn-warning w-100';
            document.getElementById('btnCancel').style.display = 'inline-block';
        }

        // Delete category
        async function deleteCategory(id) {
            const category = categories.find(c => c.id === id);
            const productCount = products.filter(p => p.categoryId === id).length;
            
            if (productCount > 0) {
                alert(`Kh√¥ng th·ªÉ x√≥a "${category.name}" v√¨ c√≤n ${productCount} s·∫£n ph·∫©m!`);
                return;
            }

            if (!confirm(`X√≥a danh m·ª•c "${category.name}"?`)) return;

            try {
                const response = await fetch(`${API_URL}/CategoryApi/${id}`, { method: 'DELETE' });
                if (!response.ok) throw new Error('L·ªói API');
                
                alert('X√≥a th√†nh c√¥ng!');
                loadData();
            } catch (error) {
                alert('L·ªói: ' + error.message);
            }
        }

        // Cancel edit
        function cancelEdit() {
            resetForm();
        }

        // Reset form
        function resetForm() {
            editingId = null;
            document.getElementById('categoryForm').reset();
            document.getElementById('formTitle').textContent = '‚ûï Th√™m danh m·ª•c m·ªõi';
            document.getElementById('btnSave').innerHTML = '‚ûï Th√™m';
            document.getElementById('btnSave').className = 'btn btn-success w-100';
            document.getElementById('btnCancel').style.display = 'none';
        }

        // Search categories
        function searchCategories() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#categoriesList tr');
            
            rows.forEach(row => {
                if (row.cells.length > 1) {
                    const name = row.cells[1].textContent.toLowerCase();
                    const desc = row.cells[2].textContent.toLowerCase();
                    row.style.display = (name.includes(searchTerm) || desc.includes(searchTerm)) ? '' : 'none';
                }
            });
        }

        // Refresh data
        function refreshData() {
            loadData();
            const btn = event.target;
            btn.textContent = '‚è≥ ƒêang t·∫£i...';
            setTimeout(() => btn.textContent = 'üîÑ L√†m m·ªõi', 1000);
        }

        // Show error
        function showError(message) {
            document.getElementById('categoriesList').innerHTML = 
                `<tr><td colspan="5" class="text-center text-danger">${message}</td></tr>`;
        }
    </script>
</body>
</html>